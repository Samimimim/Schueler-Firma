<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--Apple Scheiß-->
    <link rel="manifest" href="/manifest.json" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/static/img/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/static/img/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/static/img/favicon/favicon-16x16.png"
    />
    <link rel="shortcut icon" href="/static/img/favicon/favicon.ico" />

    <title>Schüler-Firma</title>
    <link rel="stylesheet" href="/static/style/style.css" />
    <link rel="icon" href="/static/img/favicon.png" type="image/png" />
  
</head>
<body class="center">
  <img
      src="/static/img/back.png"
      alt="Back"
      class="back-button"
      onclick="window.history.back()"
    />
  <h1>Neues Produkt hinzufügen</h1>
  <button id="openBtn">Produkt hinzufügen</button>

  <div id="overlay"></div>

  <div id="popup" role="dialog" aria-modal="true" aria-labelledby="popupTitle">
    <h3 id="popupTitle">Neues Produkt</h3>
    <input type="text" id="name" placeholder="Name" required />
    <input type="number" id="stueckzahl" placeholder="Stückzahl" required min="1" />
    <input type="number" id="preis" placeholder="Preis" required min="0" step="0.01" />
    <textarea id="beschreibung" placeholder="Beschreibung"></textarea>
    <div class="buttons">
      <button id="submitBtn">Hinzufügen</button>
      <button id="cancelBtn">Abbrechen</button>
    </div>
    <p id="status"></p>
  </div>

  <script>
    const openBtn = document.getElementById("openBtn");
    const popup = document.getElementById("popup");
    const overlay = document.getElementById("overlay");
    const cancelBtn = document.getElementById("cancelBtn");
    const submitBtn = document.getElementById("submitBtn");
    const status = document.getElementById("status");

    function openPopup() {
      popup.style.display = "block";
      overlay.style.display = "block";
      status.textContent = "";
      // Fokus auf erstes Feld setzen
      document.getElementById("name").focus();
    }

    function closePopup() {
      popup.style.display = "none";
      overlay.style.display = "none";
      status.textContent = "";
      // Felder leeren
      ["name", "stueckzahl", "preis", "beschreibung"].forEach(id => {
        document.getElementById(id).value = "";
      });
    }

    openBtn.addEventListener("click", openPopup);
    cancelBtn.addEventListener("click", closePopup);
    overlay.addEventListener("click", closePopup);

    submitBtn.addEventListener("click", async () => {
      const name = document.getElementById("name").value.trim();
      const stueckzahl = parseInt(document.getElementById("stueckzahl").value);
      const preis = parseFloat(document.getElementById("preis").value);
      const beschreibung = document.getElementById("beschreibung").value.trim();

      if (!name) {
        status.textContent = "Bitte Name eingeben!";
        return;
      }
      if (isNaN(stueckzahl) || stueckzahl < 1) {
        status.textContent = "Bitte gültige Stückzahl eingeben!";
        return;
      }
      if (isNaN(preis) || preis < 0) {
        status.textContent = "Bitte gültigen Preis eingeben!";
        return;
      }

      status.textContent = "Sende Daten...";
      submitBtn.disabled = true;

      try {
        const res = await fetch("/api/addProdukt", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, stueckzahl, beschreibung, preis }),
        });

        const result = await res.json();

        if (res.ok) {
          status.style.color = "green";
          status.textContent = "Erfolgreich hinzugefügt!";
          setTimeout(() => {
            closePopup();
            status.style.color = "#3E3F29";
            submitBtn.disabled = false;
          }, 1500);
        } else {
          status.style.color = "red";
          status.textContent = "Fehler: " + (result.error || "Unbekannt");
          submitBtn.disabled = false;
        }
      } catch (e) {
        status.style.color = "red";
        status.textContent = "Fehler beim Senden!";
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
