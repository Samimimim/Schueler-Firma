<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--Apple Scheiß-->
    <link rel="manifest" href="/manifest.json" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/static/img/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/static/img/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/static/img/favicon/favicon-16x16.png"
    />
    <link rel="shortcut icon" href="/static/img/favicon/favicon.ico" />

    <title>Schüler-Firma</title>
      <link rel="stylesheet" href="/static/style/style.css" />
  </head>
  <body class="center">
    <img
      src="/static/img/back.png"
      alt="Back"
      class="back-button"
      onclick="window.history.back()"
    />
    <h1>Produkt suchen</h1>
    <br />
    <button onclick="openPopup()">Produkt suchen</button>

    <div id="overlay"></div>

    <div id="popup" class="center small-popup">
      <h3>Inventar abfragen</h3>
      <input type="number" id="id" placeholder="ID" />
      <input type="text" id="name" placeholder="Name" />
      <button onclick="submitSuche()">Suchen</button>
      <button onclick="closePopup()">Abbrechen</button>
      <div id="result"></div>
      <p id="status"></p>
    </div>

    <script>
      function openPopup() {
        document.getElementById("popup").style.display = "block";
        document.getElementById("overlay").style.display = "block";
      }
      function closePopup() {
        document.getElementById("popup").style.display = "none";
        document.getElementById("overlay").style.display = "none";
        document.getElementById("result").innerHTML = "";
        document.getElementById("status").textContent = "";
      }

      function renderProdukt(data) {
        if (!data) return "";
        return `
          <div class="produkt-card">
            <div class="black"><strong>ID:</strong> ${data.id}</div>
            <div class="black"><strong>Name:</strong> ${data.name}</div>
            <div class="black"><strong>Beschreibung:</strong> ${data.beschreibung}</div>
            <div class="black"><strong>Preis:</strong> ${data.preis} €</div>
            <div class="black"><strong>Stückzahl:</strong> ${data.stueckzahl}</div>
          </div>
        `;
      }

      async function submitSuche() {
        const id = document.getElementById("id").value.trim();
        const name = document.getElementById("name").value.trim();

        if (!id && !name) {
          document.getElementById("status").textContent =
            "Bitte ID oder Name eingeben.";
          return;
        }

        const params = id ? `id=${id}` : `name=${encodeURIComponent(name)}`;
        const res = await fetch(`/api/SearchItem?${params}`);

        if (res.ok) {
          const json = await res.json();
          document.getElementById("result").innerHTML = renderProdukt(json);
          document.getElementById("status").textContent = "Gefunden!";
        } else {
          const err = await res.json();
          document.getElementById("result").innerHTML = "";
          document.getElementById("status").textContent =
            "Fehler: " + err.error;
        }
      }
    </script>

    <style>
      #overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: #0006;
        display: none;
      }
      #popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #fff;
        padding: 32px;
        border-radius: 12px;
        display: none;
        min-width: 200px;
        max-width: 90vw;
      }
      #popup input,
      #popup button,
      #popup textarea {
        display: block;
        margin: 8px 0;
        width: 100%;
      }
      .produkt-card {
        background: #f4f4f4;
        border-radius: 6px;
        padding: 12px 16px;
        margin-top: 12px;
        box-shadow: 0 2px 8px #0001;
        font-size: 1rem;
      }
      .produkt-card div {
        margin-bottom: 4px;
      }
      .produkt-card strong {
        color: #333;
      }
      pre {
        background: #eee;
        padding: 8px;
        white-space: pre-wrap;
      }
    </style>
  </body>
</html>
